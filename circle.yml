machine:
  post:
    - wget -nv -c 'http://www.ocamljava.org/downloads/download.php?version=2.0-alpha3-bin' -O ocamljava-2.0-alpha3-bin.tar.gz
    - tar xf ocamljava-2.0-alpha3-bin.tar.gz

dependencies:
  cache_directories:
    - "~/.opam"
  override:
    - sudo add-apt-repository -y ppa:avsm/ppa
    - sudo apt-get -qq update
    - sudo apt-get install -y ocaml-nox ocaml-native-compilers opam
    - opam init -a
    - opam install -y menhir ocamlbuild camlp5 coq:
        timeout: 1200

test:
  override:
    - eval `opam config env` && make
    - eval `opam config env` && OCAMLJAVA=~/ocamljava-2.0-alpha3 make java-extraction && cp lib/CALib.jar $CIRCLE_ARTIFACTS
